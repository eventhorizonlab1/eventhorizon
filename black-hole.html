<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Hole Visualization (Final, No GUI)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; background: #000; font-family: 'Arial', sans-serif; }
        canvas { display: block; }
    </style>
</head>
<body>
    <!-- UMD Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!THREE.OrbitControls || !THREE.EffectComposer) {
                console.error("A critical library (OrbitControls, EffectComposer) failed to load.");
                return;
            }

            let scene, camera, renderer, clock, composer, bloomPass;
            let accretionDisk, particles, gasParticles, jetParticles;
            const HORIZON_RADIUS = 2.8;

            const diskVertexShader=`varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}`;
            const diskFragmentShader=`uniform float uTime;varying vec2 vUv;float random(vec2 st){return fract(sin(dot(st.xy,vec2(12.9898,78.233)))*43758.5453123);}
            float noise(vec2 st){vec2 i=floor(st);vec2 f=fract(st);float a=random(i);float b=random(i+vec2(1.,0.));float c=random(i+vec2(0.,1.));float d=random(i+vec2(1.,1.));vec2 u=f*f*(3.-2.*f);return mix(a,b,u.x)+(c-a)*u.y*(1.-u.x)+(d-b)*u.y*u.x;}
            float fbm(vec2 st){float v=0.;float a=.5;for(int i=0;i<6;++i){v+=a*noise(st);st*=2.;a*=.5;}return v;}
            void main(){vec2 cUv=vUv-vec2(.5);float r=length(cUv)*2.;float iR=.3;float oR=1.;float twist=10./(r+.15);float ang=atan(cUv.y,cUv.x)+twist*uTime*.04;vec2 nUv=vec2(cos(ang)*r,sin(ang)*r)*2.;float nVal=fbm(nUv+uTime*.08);nVal=(nVal-.25)*2.5;vec3 cC=vec3(1.,.95,.85);vec3 cH=vec3(1.,.7,.2);vec3 cW=vec3(1.,.3,.05);vec3 cCl=vec3(.8,.15,.3);vec3 cE=vec3(.4,.1,.6);vec3 col=vec3(0.);float rN=(r-iR)/(oR-iR);if(rN<.3){col=mix(cC,cH,rN/.3);}else if(rN<.6){col=mix(cH,cW,(rN-.3)/.3);}else if(rN<.85){col=mix(cW,cCl,(rN-.6)/.25);}else{col=mix(cCl,cE,(rN-.85)/.15);}col=mix(col,cC,smoothstep(.65,.85,nVal)*.7);col=mix(col,cE*.5,smoothstep(-.3,0.,nVal)*.3);col*=1.+smoothstep(iR+.4,iR,r)*1.5;col*=smoothstep(iR-.02,iR+.08,r);float mask=smoothstep(iR,iR+.04,r)*(1.-smoothstep(oR-.1,oR,r));mask*=.7+.3*smoothstep(.3,.6,nVal);if(mask<.02)discard;gl_FragColor=vec4(col*2.,mask*.9);}`;
            const particleVertexShader=`uniform float uTime;uniform float uHorizonRadius;uniform float uSpeedMultiplier;attribute vec3 customData;attribute float size;varying vec3 vColor;varying float vOpacity;void main(){vColor=color;float iR=customData.x;float iA=customData.y;float s=customData.z;float fT=(iR-uHorizonRadius)/(s*25.)+1.;float l=mod(uTime*.2*uSpeedMultiplier,fT);float cR=iR-(l*(s*25.));float nA=iA+uTime*s*4.*uSpeedMultiplier;float y=position.y*(cR/iR);vec3 nP=vec3(cR*cos(nA),y,cR*sin(nA));vOpacity=smoothstep(uHorizonRadius,uHorizonRadius+2.,cR);vec4 mvP=modelViewMatrix*vec4(nP,1.);gl_Position=projectionMatrix*mvP;gl_PointSize=size>0.?size*(20./-mvP.z):.12*(20./-mvP.z);}`;
            const particleFragmentShader=`varying vec3 vColor;varying float vOpacity;void main(){float d=length(gl_PointCoord-vec2(.5));if(d>.5)discard;gl_FragColor=vec4(vColor,vOpacity*(1.-d*2.));}`;
            const jetVertexShader=`uniform float uTime;uniform float uSpeedMultiplier;attribute vec3 customData;varying vec3 vColor;varying float vOpacity;void main(){vColor=color;float v=customData.x;float mL=customData.y;float l=mod(uTime*v*uSpeedMultiplier,mL);vec3 nP=position;nP.y=sign(position.y)*(abs(position.y)+l);float fI=smoothstep(0.,mL*.1,l);float fO=smoothstep(mL,mL*.8,l);vOpacity=fI*fO;vec4 mvP=modelViewMatrix*vec4(nP,1.);gl_Position=projectionMatrix*mvP;gl_PointSize=(2.*vOpacity)*(50./-mvP.z);}`;

            function init() {
                clock = new THREE.Clock();
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, .1, 1000);
                camera.position.set(12, 10, 12);
                renderer = new THREE.WebGLRenderer({antialias:true});
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                document.body.appendChild(renderer.domElement);
                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;

                createStarfield();
                createEventHorizon();
                createAccretionDisk();
                createParticles(10000);
                createGasParticles(3000);
                createJetParticles(2000);
                setupPostProcessing();

                window.addEventListener('resize', onWindowResize);
                animate();
            }

            function createStarfield(){const sG=new THREE.BufferGeometry();const sV=[];for(let i=0;i<5000;i++){sV.push((Math.random()-.5)*500,(Math.random()-.5)*500,(Math.random()-.5)*500);}sG.setAttribute('position',new THREE.Float32BufferAttribute(sV,3));const sM=new THREE.PointsMaterial({color:0xffffff,size:.4});scene.add(new THREE.Points(sG,sM));}
            function createEventHorizon(){const g=new THREE.SphereGeometry(HORIZON_RADIUS,32,32);const m=new THREE.MeshBasicMaterial({color:0});scene.add(new THREE.Mesh(g,m));}
            function createAccretionDisk(){const g=new THREE.PlaneGeometry(24,24,32,32);const m=new THREE.ShaderMaterial({uniforms:{uTime:{value:0}},vertexShader:diskVertexShader,fragmentShader:diskFragmentShader,transparent:true,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthWrite:false});accretionDisk=new THREE.Mesh(g,m);accretionDisk.rotation.x=-Math.PI/2;scene.add(accretionDisk);}
            function createParticles(c){const pG=new THREE.BufferGeometry(),pos=new Float32Array(c*3),cD=new Float32Array(c*3),clr=new Float32Array(c*3),s=new Float32Array(c),co=new THREE.Color();for(let i=0;i<c;i++){const i3=i*3,r=5+Math.random()*30,a=Math.random()*Math.PI*2,y=(Math.random()-.5)*6;pos[i3]=r*Math.cos(a);pos[i3+1]=y;pos[i3+2]=r*Math.sin(a);cD[i3]=r;cD[i3+1]=a;cD[i3+2]=(.015+Math.random()*.025)/(r*.08+.1);co.setHSL(.05+Math.random()*.15,.9,.7+Math.random()*.3);clr[i3]=co.r;clr[i3+1]=co.g;clr[i3+2]=co.b;s[i]=0;}pG.setAttribute('position',new THREE.BufferAttribute(pos,3));pG.setAttribute('customData',new THREE.BufferAttribute(cD,3));pG.setAttribute('color',new THREE.BufferAttribute(clr,3));pG.setAttribute('size',new THREE.BufferAttribute(s,1));const pM=new THREE.ShaderMaterial({uniforms:{uTime:{value:0},uHorizonRadius:{value:HORIZON_RADIUS},uSpeedMultiplier:{value:1}},vertexShader:particleVertexShader,fragmentShader:particleFragmentShader,vertexColors:true,blending:THREE.AdditiveBlending,transparent:true,depthWrite:false});particles=new THREE.Points(pG,pM);scene.add(particles);}
            function createGasParticles(c){const pG=new THREE.BufferGeometry(),pos=new Float32Array(c*3),cD=new Float32Array(c*3),clr=new Float32Array(c*3),s=new Float32Array(c),co=new THREE.Color(0xff6633);for(let i=0;i<c;i++){const i3=i*3,r=6+Math.random()*20,a=Math.random()*Math.PI*2,y=(Math.random()-.5)*4;pos[i3]=r*Math.cos(a);pos[i3+1]=y;pos[i3+2]=r*Math.sin(a);cD[i3]=r;cD[i3+1]=a;cD[i3+2]=(.01+Math.random()*.02)/(r*.1+.1);clr[i3]=co.r*(.8+Math.random()*.4);clr[i3+1]=co.g*(.8+Math.random()*.4);clr[i3+2]=co.b*(.8+Math.random()*.4);s[i]=1.5+Math.random()*2.5;}pG.setAttribute('position',new THREE.BufferAttribute(pos,3));pG.setAttribute('customData',new THREE.BufferAttribute(cD,3));pG.setAttribute('color',new THREE.BufferAttribute(clr,3));pG.setAttribute('size',new THREE.BufferAttribute(s,1));const pM=new THREE.ShaderMaterial({uniforms:{uTime:{value:0},uHorizonRadius:{value:HORIZON_RADIUS},uSpeedMultiplier:{value:1}},vertexShader:particleVertexShader,fragmentShader:particleFragmentShader,vertexColors:true,blending:THREE.AdditiveBlending,transparent:true,depthWrite:false});gasParticles=new THREE.Points(pG,pM);scene.add(gasParticles);}
            function createJetParticles(c){const pG=new THREE.BufferGeometry(),pos=new Float32Array(c*3),cD=new Float32Array(c*3),clr=new Float32Array(c*3),co=new THREE.Color();for(let i=0;i<c;i++){const i3=i*3,r=Math.random()*.5,a=Math.random()*Math.PI*2,s=i<c/2?1:-1;pos[i3]=r*Math.cos(a);pos[i3+1]=s*(HORIZON_RADIUS+.1+Math.random()*.5);pos[i3+2]=r*Math.sin(a);cD[i3]=30+Math.random()*15;cD[i3+1]=50+Math.random()*30;co.setHSL(.55+Math.random()*.1,.9,.8+Math.random()*.2);clr[i3]=co.r;clr[i3+1]=co.g;clr[i3+2]=co.b;}pG.setAttribute('position',new THREE.BufferAttribute(pos,3));pG.setAttribute('customData',new THREE.BufferAttribute(cD,3));pG.setAttribute('color',new THREE.BufferAttribute(clr,3));const pM=new THREE.ShaderMaterial({uniforms:{uTime:{value:0},uSpeedMultiplier:{value:1}},vertexShader:jetVertexShader,fragmentShader:particleFragmentShader,vertexColors:true,blending:THREE.AdditiveBlending,transparent:true,depthWrite:false});jetParticles=new THREE.Points(pG,pM);scene.add(jetParticles);}
            function setupPostProcessing(){composer=new THREE.EffectComposer(renderer);composer.addPass(new THREE.RenderPass(scene,camera));const bP=new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth,window.innerHeight),1.8,0.35,0.15);composer.addPass(bP);const fP=new THREE.ShaderPass(THREE.CopyShader);fP.renderToScreen=true;composer.addPass(fP);}
            function animate(){requestAnimationFrame(animate);const e=clock.getElapsedTime();if(accretionDisk)accretionDisk.material.uniforms.uTime.value=e;if(particles)particles.material.uniforms.uTime.value=e;if(gasParticles)gasParticles.material.uniforms.uTime.value=e;if(jetParticles)jetParticles.material.uniforms.uTime.value=e;composer.render(clock.getDelta());}
            function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);composer.setSize(window.innerWidth,window.innerHeight);}

            init();
        });
    </script>
</body>
</html>
